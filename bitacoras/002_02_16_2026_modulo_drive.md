# Bitácora 002_02_16_2026 hora 11:01:51 modulo_drive

## Qué fue lo que se hizo
- Se implementó el módulo `backup_drive.sh` que sincroniza todo el contenido de Google Drive al disco local usando `rclone sync`.
- El módulo verifica que `rclone` esté instalado y que el remote configurado exista en `rclone listremotes` antes de ejecutar la sincronización.
- Se usa `rclone sync` con `--transfers 4` para paralelizar descargas y `--log-level ERROR` para capturar solo errores en la salida.
- Se agregaron variables en `config.env`: `BACKUP_DRIVE_DIR` (directorio destino) y `BACKUP_DRIVE_REMOTE` (nombre del remote sin `:`, para mayor generalidad).
- El módulo construye la URL de rclone como `${BACKUP_DRIVE_REMOTE}:` internamente, separando el nombre del remote de la sintaxis de rclone.
- Se reconectó el token OAuth de rclone que estaba expirado con `rclone config reconnect`.
- Se probó la sincronización con una carpeta pequeña de Drive (`CEVU2015`, 462KB, 2 archivos) confirmando que rclone descarga correctamente al destino.

Archivos modificados: `src/modulos/backup_drive.sh`, `src/config.env`.

## Para qué se hizo
- Implementar el segundo componente real del sistema de backups (Fase 3), permitiendo respaldar todo el contenido de Google Drive de forma incremental con `rclone sync`.

## Qué problemas se presentaron
- El token OAuth de rclone estaba expirado, impidiendo la conexión a Google Drive. Error: `couldn't fetch token - maybe it has expired?`.
- La verificación del remote en el módulo fallaba cuando se intentaba usar una subcarpeta como remote (ej. `gdrive-rodanmuro:CEVU2015`), porque `rclone listremotes` solo devuelve `gdrive-rodanmuro:`.
- La variable `BACKUP_DRIVE_REMOTE` inicialmente incluía los `:`, lo que la hacía menos genérica y causaba problemas al concatenar rutas.

## Cómo se resolvieron
- El token se reconectó manualmente con `rclone config reconnect gdrive-rodanmuro:`, que abre el navegador para re-autenticar con Google.
- Se separó el nombre del remote (sin `:`) en `config.env` y el módulo ahora agrega `:` internamente al construir la URL de rclone y al buscar en `rclone listremotes`. Esto hace la configuración más limpia y genérica.

## Qué continúa
- Fase 4: Implementar módulo de verificación de sincronización Gmail/Thunderbird.
- Fase 5: Configurar servicio systemd para ejecución automática al encender.

*(Archivos clave: [backup_drive.sh](../src/modulos/backup_drive.sh), [config.env](../src/config.env))*
